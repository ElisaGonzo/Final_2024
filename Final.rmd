---
title: "Covid91 vaccine study Final2024"
author: "Elisa Gonzalez"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, covid19 = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
Gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

##Overall apporach 

1. **Descriptive Analysis**: Summarize data perceptibly then numerically.  
2. **Inferential Analysis**: Perform hypothesis testing:  
   - \(H_0\): The vaccine has no impact on infection rates.  
   - \(H_A\): The vaccine reduces infection rates.  
3. **Effectiveness Calculation**:
   \[ 
   \text{Vaccine Effectiveness (VE)} = 1 -  \frac{\text{Risk}_{\text{vaccine}}}{\text{Risk}_{\text{placebo}}}
   \]
4. **Effectivness Confidence Interval**: low to high

## Males

```{r}
male_summary <- Male %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
male_summary <- male_summary %>%
  mutate(total = rowSums(select(., -treatment)))
male_column_totals <- male_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
male_summary <- bind_rows(male_summary, male_column_totals)
male_summary
```

Here’s the current data for men: There are 18,392 men in total. Of these, 18,037 are considered healthy, while 355 have COVID. To better illustrate this, let's include a bar plot for a clearer visual representation, as the numbers alone don't effectively show the trend.

###Visual results 
```{r}
# Bar plot

# Summarize the data for Males by infection status and treatment
male_summary_data <- Male %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
male_plot_count <- ggplot(male_summary_data, aes(x = infected, y = count, fill = treatment))
male_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Males Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
male_plot_percent <- ggplot(male_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
male_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Males Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()
```

The bar plots above show the number of males infected with COVID-19. In both graphs, the results are similar to the placebo group, but visually, males who received the vaccination seem to have lower COVID rates compared to the placebo group. Although there is a noticeable difference, we need to conduct a statistical analysis to determine if this difference is significant.

### Numerical Results
```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```

The numerical data shows that 73.8% of the infected males received the placebo, while 26.2% received the vaccine. Among the healthy individuals, 49.99% received the vaccine, and 50.01% received the placebo. Overall, 2.82% of males who received the placebo contracted COVID-19, compared to just 1.02% of those who received the vaccine, suggesting that the vaccination reduces infection rates. These findings support the conclusion that the vaccine is effective in reducing COVID-19 in males, which aligns with the trends shown in the bar plots.

### Inferential Results
```{r}
chisq.test(table1)
chisqtestGC(table1)
Malefish <- fisher.test(table1)
Malefish
```

Fisher's Exact Test produces an extremely small p-value of 0.00000000000000022, which is the key result to focus on. This suggests that the observed differences in infection rates between the vaccine and placebo groups are highly unlikely to have occurred by chance. Therefore, we reject the null hypothesis, which posits that treatment has no effect on infection rates. The odds ratio of approximately 2.82 indicates that males who received the vaccine had about a 2.8 times higher risk of contracting COVID-19 compared to those who received the placebo. These results imply that the vaccine has minimal impact on preventing COVID-19 in males.

```{r}
# Calculate effectiveness
male_effect <- Malefish$p.value / (Malefish$p.value + 1)
effectiveness_male <- (1 - 1 / Malefish$estimate) * 100
print(effectiveness_male)

# Calculate effectiveness confidence interval
male_low <- (1 - 1 / Malefish$conf.int[1]) * 100
male_hi <- (1 - 1 / Malefish$conf.int[2]) * 100
options(digits = 2)

#print 
male_low
male_hi
```

### `r effectiveness_male`% Effectiveness with Confidence Interval: `r male_low`%  to `r male_hi`%

The COVID-19 vaccine for men demonstrates an efficacy of 64.48%, surpassing the 50% threshold for success. The confidence interval ranges from 54.75% to 72.32%, reinforcing its effectiveness in reducing infection rates among males. Based on the low p-value from Fisher's Exact Test and an odds ratio of 2.82, we reject the null hypothesis (which suggests no effect) and accept the alternative hypothesis (that the vaccine reduces infection rates). This indicates that vaccinated men are nearly 2.8 times more likely to avoid contracting COVID-19 compared to those who received the placebo. The confidence interval further supports the vaccine’s strong protective effect.


## Females

### Summary of Females
```{r}
female_summary <- Female %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
female_summary <- female_summary %>%
  mutate(total = rowSums(select(., -treatment)))
female_column_totals <- female_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
female_summary <- bind_rows(female_summary, female_column_totals)
female_summary
```

Here’s the data for the women so far: There are 18,328 females in total, with 17,963 being healthy and 365 infected with COVID. Since these numbers alone don’t clearly show a trend, let’s add a bar plot for better visual representation.

### Visual Results

```{r}
# Bar plot

# Summarize the data for Females by infection status and treatment
female_summary_data <- Female %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
female_plot_count <- ggplot(female_summary_data, aes(x = infected, y = count, fill = treatment))
female_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Females Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
female_plot_percent <- ggplot(female_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
female_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Females Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()
```

The bar plots above show the number of females infected with COVID-19. In both graphs, the results are similar to the placebo group, but visually, females who received the vaccine appear to have lower COVID rates compared to those who received the placebo. While the difference is noticeable, we need to conduct a statistical analysis to determine if it is significant.

### Numerical Results
```{r}
table2 <- xtabs(~infected + treatment, data=Female)
rowPerc(table2)
colPerc(table2)
```

The numerical data shows that 35% of the infected females received the vaccine, while 65% received the placebo. Among the healthy individuals, half received the vaccine and half received the placebo. Overall, 1.4% of females who received the vaccine contracted COVID-19, compared to 2.6% of those who received the placebo, suggesting that the vaccine reduces infection rates. These findings indicate that the vaccine is effective in lowering COVID-19 rates in females, which is consistent with the bar plots illustrating its efficacy.

### Inferential Results
```{r}
chisq.test(table2)
chisqtestGC(table2)
Femalefish <- fisher.test(table2)
Femalefish
```

The main takeaway from Fisher's Exact Test is that the difference in infection rates between the vaccine and placebo groups is highly unlikely to have occurred by chance, with an extremely small p-value of 0.00000001. As a result, we reject the null hypothesis, which suggests the treatment has no impact on infection rates. The odds ratio of approximately 1.9 indicates that women who received the vaccine had nearly twice the risk of contracting COVID-19 compared to those who received the placebo. Therefore, these results suggest that the vaccine is ineffective at preventing COVID-19 in females.  
 
## LGBTQ



## Druggies


# Overall Results and Conclusions